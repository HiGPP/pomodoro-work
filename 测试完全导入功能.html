<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®Œå…¨å¯¼å…¥åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .test-item {
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .test-item h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .test-item.success {
            border-color: #28a745;
            background: #d4edda;
        }
        .test-item.warning {
            border-color: #ffc107;
            background: #fff3cd;
        }
        .test-item.error {
            border-color: #dc3545;
            background: #f8d7da;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background: #28a745; color: white; }
        .status.warning { background: #ffc107; color: black; }
        .status.error { background: #dc3545; color: white; }
    </style>
</head>
<body>
    <h1>å®Œå…¨å¯¼å…¥åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>æµ‹è¯•æ•°æ®è§£æ</h3>
        <button onclick="testParseCompleteData()">æµ‹è¯•å®Œæ•´æ•°æ®è§£æ</button>
        <div id="parseResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>å¯¼å…¥åŠŸèƒ½æµ‹è¯•</h3>
        <button onclick="testFileImport()">é€‰æ‹©æ–‡ä»¶æµ‹è¯•å®Œå…¨å¯¼å…¥</button>
        <div id="importResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>æ•°æ®å®Œæ•´æ€§æ£€æŸ¥</h3>
        <div class="test-grid" id="dataCheckGrid">
            <!-- æµ‹è¯•é¡¹ç›®å°†åœ¨è¿™é‡Œç”Ÿæˆ -->
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿè§£æå‡½æ•°
        function parseAndImportMarkdown(markdownContent) {
            try {
                const lines = markdownContent.split('\n');
                let currentSection = '';
                let tasks = [];
                let pomodoroData = [];
                let completedTasks = [];
                let incompleteTasks = [];
                let dailyGains = '';
                let improvements = '';
                let startTime = '';
                let currentDate = '';
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // è§£ææ—¥æœŸ
                    if (line.startsWith('## æ—¥æœŸï¼š')) {
                        currentDate = line.replace('## æ—¥æœŸï¼š', '').trim();
                        continue;
                    }
                    
                    // æ£€æµ‹ç« èŠ‚
                    if (line.startsWith('### ä»Šæ—¥ç›®æ ‡ä»»åŠ¡')) {
                        currentSection = 'tasks';
                        continue;
                    } else if (line.startsWith('### ç•ªèŒ„æ—¶æ®µè®°å½•')) {
                        currentSection = 'pomodoro';
                        continue;
                    } else if (line.startsWith('**å®Œæˆçš„ä»»åŠ¡ï¼š**')) {
                        currentSection = 'completed';
                        continue;
                    } else if (line.startsWith('**æœªå®Œæˆçš„ä»»åŠ¡ï¼š**')) {
                        currentSection = 'incomplete';
                        continue;
                    } else if (line.startsWith('**ä»Šæ—¥æ”¶è·ï¼š**')) {
                        currentSection = 'gains';
                        continue;
                    } else if (line.startsWith('**æ˜æ—¥æ”¹è¿›ç‚¹ï¼š**')) {
                        currentSection = 'improvements';
                        continue;
                    }
                    
                    // è§£æä»»åŠ¡
                    if (currentSection === 'tasks' && line.startsWith('- [')) {
                        const taskMatch = line.match(/- \[([ x])\] ä»»åŠ¡(\d+)ï¼š(.+)/);
                        if (taskMatch) {
                            const status = taskMatch[1];
                            const taskNum = taskMatch[2];
                            const taskText = taskMatch[3];
                            tasks.push({
                                number: parseInt(taskNum),
                                text: taskText,
                                completed: status === 'x'
                            });
                        }
                    }
                    
                    // è§£æç•ªèŒ„æ—¶æ®µ
                    if (currentSection === 'pomodoro' && line.startsWith('|') && !line.includes('---')) {
                        const parts = line.split('|').map(p => p.trim()).filter(p => p);
                        if (parts.length >= 5) {
                            const timeRange = parts[0];
                            const taskContent = parts[1];
                            const status = parts[2];
                            const completion = parts[3];
                            const notes = parts[4];
                            
                            // æå–å¼€å§‹æ—¶é—´
                            if (!startTime && timeRange.includes('-')) {
                                const timeMatch = timeRange.match(/(\d{2}:\d{2})-/);
                                if (timeMatch) {
                                    startTime = timeMatch[1];
                                }
                            }
                            
                            pomodoroData.push({
                                timeRange: timeRange,
                                taskContent: taskContent,
                                status: status,
                                completion: completion,
                                notes: notes
                            });
                        }
                    }
                    
                    // è§£æå®Œæˆçš„ä»»åŠ¡
                    if (currentSection === 'completed' && line.startsWith('- âœ…')) {
                        const taskText = line.replace('- âœ…', '').trim();
                        if (taskText) {
                            completedTasks.push(taskText);
                        }
                    }
                    
                    // è§£ææœªå®Œæˆçš„ä»»åŠ¡
                    if (currentSection === 'incomplete' && line.startsWith('- âŒ')) {
                        const taskText = line.replace('- âŒ', '').trim();
                        if (taskText) {
                            incompleteTasks.push(taskText);
                        }
                    }
                    
                    // è§£æä»Šæ—¥æ”¶è·
                    if (currentSection === 'gains' && line && !line.startsWith('**')) {
                        if (dailyGains) dailyGains += '\n';
                        dailyGains += line;
                    }
                    
                    // è§£ææ˜æ—¥æ”¹è¿›ç‚¹
                    if (currentSection === 'improvements' && line && !line.startsWith('**')) {
                        if (improvements) improvements += '\n';
                        improvements += line;
                    }
                }
                
                return {
                    currentDate: currentDate,
                    startTime: startTime,
                    tasks: tasks,
                    pomodoroData: pomodoroData,
                    completedTasks: completedTasks,
                    incompleteTasks: incompleteTasks,
                    dailyGains: dailyGains,
                    improvements: improvements
                };
                
            } catch (error) {
                console.error('è§£æå¤±è´¥:', error);
                throw error;
            }
        }
        
        function testParseCompleteData() {
            const testData = `# ç•ªèŒ„å·¥ä½œæ³•è¿½è¸ªè¡¨

## æ—¥æœŸï¼š2024å¹´1æœˆ15æ—¥ æ˜ŸæœŸä¸€

### ä»Šæ—¥ç›®æ ‡ä»»åŠ¡
- [x] ä»»åŠ¡1ï¼šå®Œæˆé¡¹ç›®éœ€æ±‚åˆ†ææ–‡æ¡£
- [ ] ä»»åŠ¡2ï¼šè®¾è®¡ç”¨æˆ·ç•Œé¢åŸå‹
- [x] ä»»åŠ¡3ï¼šç¼–å†™æ ¸å¿ƒåŠŸèƒ½ä»£ç 

### ç•ªèŒ„æ—¶æ®µè®°å½•

| æ—¶é—´æ®µ | ä»»åŠ¡å†…å®¹ | å®ŒæˆçŠ¶æ€ | å®Œæˆåº¦ | å¤‡æ³¨/å¹²æ‰°è®°å½• |
|--------|----------|----------|--------|---------------|
| 09:00-09:25 | é¡¹ç›®éœ€æ±‚åˆ†æ | âœ… | 100% | é¡ºåˆ©å®Œæˆ |
| 09:30-09:55 | éœ€æ±‚æ–‡æ¡£ç¼–å†™ | âœ… | 90% | éœ€è¦è¡¥å……ç»†èŠ‚ |
| 10:00-10:25 | ç•Œé¢è®¾è®¡æ„æ€ | â­• | | è¢«ç”µè¯æ‰“æ–­ |
| **é•¿ä¼‘æ¯ 11:00-11:30** | **ğŸƒ ä¼‘æ¯æ—¶é—´** |   |        |               |
| 11:30-11:55 | æ ¸å¿ƒåŠŸèƒ½å¼€å‘ | âœ… | 80% | é‡åˆ°æŠ€æœ¯é—®é¢˜ |

### ä»Šæ—¥æ€»ç»“

**å®Œæˆçš„ä»»åŠ¡ï¼š**
- âœ… å®Œæˆé¡¹ç›®éœ€æ±‚åˆ†ææ–‡æ¡£
- âœ… ç¼–å†™æ ¸å¿ƒåŠŸèƒ½ä»£ç 

**æœªå®Œæˆçš„ä»»åŠ¡ï¼š**
- âŒ è®¾è®¡ç”¨æˆ·ç•Œé¢åŸå‹

**ä»Šæ—¥æ”¶è·ï¼š**
é€šè¿‡ç•ªèŒ„å·¥ä½œæ³•ï¼Œæˆ‘å‘ç°è‡ªå·±èƒ½å¤Ÿæ›´ä¸“æ³¨åœ°å¤„ç†å¤æ‚ä»»åŠ¡ã€‚

**æ˜æ—¥æ”¹è¿›ç‚¹ï¼š**
1. æå‰å‡†å¤‡è®¾è®¡ç´ æ
2. è®¾ç½®å…æ‰“æ‰°æ¨¡å¼`;

            try {
                const result = parseAndImportMarkdown(testData);
                document.getElementById('parseResult').textContent = 
                    'è§£ææˆåŠŸï¼\n\n' +
                    'æ—¥æœŸï¼š' + result.currentDate + '\n' +
                    'å¼€å§‹æ—¶é—´ï¼š' + result.startTime + '\n\n' +
                    'ä»»åŠ¡æ•°æ®ï¼š' + JSON.stringify(result.tasks, null, 2) + '\n\n' +
                    'ç•ªèŒ„æ—¶æ®µæ•°æ®ï¼š' + JSON.stringify(result.pomodoroData, null, 2) + '\n\n' +
                    'å®Œæˆçš„ä»»åŠ¡ï¼š' + JSON.stringify(result.completedTasks, null, 2) + '\n\n' +
                    'æœªå®Œæˆçš„ä»»åŠ¡ï¼š' + JSON.stringify(result.incompleteTasks, null, 2) + '\n\n' +
                    'ä»Šæ—¥æ”¶è·ï¼š' + result.dailyGains + '\n\n' +
                    'æ˜æ—¥æ”¹è¿›ç‚¹ï¼š' + result.improvements;
            } catch (error) {
                document.getElementById('parseResult').textContent = 'è§£æå¤±è´¥ï¼š' + error.message;
            }
        }
        
        function testFileImport() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.md,.txt';
            fileInput.style.display = 'none';
            
            fileInput.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const markdownContent = e.target.result;
                            const result = parseAndImportMarkdown(markdownContent);
                            
                            let importResult = 'æ–‡ä»¶å¯¼å…¥æˆåŠŸï¼\n\n';
                            importResult += 'è§£æåˆ°çš„æ•°æ®ï¼š\n';
                            importResult += 'æ—¥æœŸï¼š' + (result.currentDate || 'æœªæ‰¾åˆ°') + '\n';
                            importResult += 'å¼€å§‹æ—¶é—´ï¼š' + (result.startTime || 'æœªæ‰¾åˆ°') + '\n';
                            importResult += 'ä»»åŠ¡æ•°é‡ï¼š' + result.tasks.length + '\n';
                            importResult += 'ç•ªèŒ„æ—¶æ®µæ•°é‡ï¼š' + result.pomodoroData.length + '\n';
                            importResult += 'å®Œæˆçš„ä»»åŠ¡æ•°é‡ï¼š' + result.completedTasks.length + '\n';
                            importResult += 'æœªå®Œæˆçš„ä»»åŠ¡æ•°é‡ï¼š' + result.incompleteTasks.length + '\n';
                            importResult += 'ä»Šæ—¥æ”¶è·ï¼š' + (result.dailyGains ? 'æœ‰å†…å®¹' : 'æ— å†…å®¹') + '\n';
                            importResult += 'æ˜æ—¥æ”¹è¿›ç‚¹ï¼š' + (result.improvements ? 'æœ‰å†…å®¹' : 'æ— å†…å®¹') + '\n';
                            
                            document.getElementById('importResult').textContent = importResult;
                            
                            // æ›´æ–°æ•°æ®å®Œæ•´æ€§æ£€æŸ¥
                            updateDataCheckGrid(result);
                            
                        } catch (error) {
                            document.getElementById('importResult').textContent = 'å¯¼å…¥å¤±è´¥ï¼š' + error.message;
                        }
                    };
                    reader.readAsText(file, 'utf-8');
                }
            };
            
            document.body.appendChild(fileInput);
            fileInput.click();
            document.body.removeChild(fileInput);
        }
        
        function updateDataCheckGrid(result) {
            const grid = document.getElementById('dataCheckGrid');
            grid.innerHTML = '';
            
            const checks = [
                {
                    name: 'æ—¥æœŸä¿¡æ¯',
                    value: result.currentDate,
                    status: result.currentDate ? 'success' : 'error'
                },
                {
                    name: 'å¼€å§‹æ—¶é—´',
                    value: result.startTime,
                    status: result.startTime ? 'success' : 'warning'
                },
                {
                    name: 'ä»»åŠ¡æ•°æ®',
                    value: result.tasks.length + ' ä¸ªä»»åŠ¡',
                    status: result.tasks.length > 0 ? 'success' : 'warning'
                },
                {
                    name: 'ç•ªèŒ„æ—¶æ®µ',
                    value: result.pomodoroData.length + ' ä¸ªæ—¶æ®µ',
                    status: result.pomodoroData.length > 0 ? 'success' : 'warning'
                },
                {
                    name: 'å®Œæˆçš„ä»»åŠ¡',
                    value: result.completedTasks.length + ' ä¸ª',
                    status: result.completedTasks.length >= 0 ? 'success' : 'error'
                },
                {
                    name: 'æœªå®Œæˆçš„ä»»åŠ¡',
                    value: result.incompleteTasks.length + ' ä¸ª',
                    status: result.incompleteTasks.length >= 0 ? 'success' : 'error'
                },
                {
                    name: 'ä»Šæ—¥æ”¶è·',
                    value: result.dailyGains ? 'æœ‰å†…å®¹' : 'æ— å†…å®¹',
                    status: result.dailyGains ? 'success' : 'warning'
                },
                {
                    name: 'æ˜æ—¥æ”¹è¿›ç‚¹',
                    value: result.improvements ? 'æœ‰å†…å®¹' : 'æ— å†…å®¹',
                    status: result.improvements ? 'success' : 'warning'
                }
            ];
            
            checks.forEach(check => {
                const item = document.createElement('div');
                item.className = `test-item ${check.status}`;
                item.innerHTML = `
                    <h4>${check.name}</h4>
                    <div>${check.value}</div>
                    <span class="status ${check.status}">${getStatusText(check.status)}</span>
                `;
                grid.appendChild(item);
            });
        }
        
        function getStatusText(status) {
            switch(status) {
                case 'success': return 'âœ“ æˆåŠŸ';
                case 'warning': return 'âš  è­¦å‘Š';
                case 'error': return 'âœ— é”™è¯¯';
                default: return '? æœªçŸ¥';
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            updateDataCheckGrid({});
        };
    </script>
</body>
</html> 