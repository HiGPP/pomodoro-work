<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>导入功能测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Markdown导入功能测试</h1>
    
    <div class="test-section">
        <h3>测试数据解析</h3>
        <button onclick="testParseMarkdown()">测试解析示例数据</button>
        <div id="parseResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>文件导入测试</h3>
        <button onclick="testFileImport()">选择文件测试导入</button>
        <div id="importResult" class="result"></div>
    </div>

    <script>
        // 模拟解析函数
        function parseAndImportMarkdown(markdownContent) {
            try {
                const lines = markdownContent.split('\n');
                let currentSection = '';
                let tasks = [];
                let pomodoroData = [];
                let completedTasks = [];
                let incompleteTasks = [];
                let dailyGains = '';
                let improvements = '';
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // 检测章节
                    if (line.startsWith('### 今日目标任务')) {
                        currentSection = 'tasks';
                        continue;
                    } else if (line.startsWith('### 番茄时段记录')) {
                        currentSection = 'pomodoro';
                        continue;
                    } else if (line.startsWith('**完成的任务：**')) {
                        currentSection = 'completed';
                        continue;
                    } else if (line.startsWith('**未完成的任务：**')) {
                        currentSection = 'incomplete';
                        continue;
                    } else if (line.startsWith('**今日收获：**')) {
                        currentSection = 'gains';
                        continue;
                    } else if (line.startsWith('**明日改进点：**')) {
                        currentSection = 'improvements';
                        continue;
                    }
                    
                    // 解析任务
                    if (currentSection === 'tasks' && line.startsWith('- [')) {
                        const taskMatch = line.match(/- \[([ x])\] 任务(\d+)：(.+)/);
                        if (taskMatch) {
                            const status = taskMatch[1];
                            const taskNum = taskMatch[2];
                            const taskText = taskMatch[3];
                            tasks.push({
                                number: parseInt(taskNum),
                                text: taskText,
                                completed: status === 'x'
                            });
                        }
                    }
                    
                    // 解析番茄时段
                    if (currentSection === 'pomodoro' && line.startsWith('|') && !line.includes('---')) {
                        const parts = line.split('|').map(p => p.trim()).filter(p => p);
                        if (parts.length >= 5) {
                            const timeRange = parts[0];
                            const taskContent = parts[1];
                            const status = parts[2];
                            const completion = parts[3];
                            const notes = parts[4];
                            
                            pomodoroData.push({
                                timeRange: timeRange,
                                taskContent: taskContent,
                                status: status,
                                completion: completion,
                                notes: notes
                            });
                        }
                    }
                    
                    // 解析完成的任务
                    if (currentSection === 'completed' && line.startsWith('- ✅')) {
                        const taskText = line.replace('- ✅', '').trim();
                        if (taskText) {
                            completedTasks.push(taskText);
                        }
                    }
                    
                    // 解析未完成的任务
                    if (currentSection === 'incomplete' && line.startsWith('- ❌')) {
                        const taskText = line.replace('- ❌', '').trim();
                        if (taskText) {
                            incompleteTasks.push(taskText);
                        }
                    }
                    
                    // 解析今日收获
                    if (currentSection === 'gains' && line && !line.startsWith('**')) {
                        if (dailyGains) dailyGains += '\n';
                        dailyGains += line;
                    }
                    
                    // 解析明日改进点
                    if (currentSection === 'improvements' && line && !line.startsWith('**')) {
                        if (improvements) improvements += '\n';
                        improvements += line;
                    }
                }
                
                return {
                    tasks: tasks,
                    pomodoroData: pomodoroData,
                    completedTasks: completedTasks,
                    incompleteTasks: incompleteTasks,
                    dailyGains: dailyGains,
                    improvements: improvements
                };
                
            } catch (error) {
                console.error('解析失败:', error);
                throw error;
            }
        }
        
        function testParseMarkdown() {
            const testData = `# 番茄工作法追踪表

## 日期：2024年1月15日 星期一

### 今日目标任务
- [x] 任务1：完成项目需求分析文档
- [ ] 任务2：设计用户界面原型
- [x] 任务3：编写核心功能代码

### 番茄时段记录

| 时间段 | 任务内容 | 完成状态 | 完成度 | 备注/干扰记录 |
|--------|----------|----------|--------|---------------|
| 09:00-09:25 | 项目需求分析 | ✅ | 100% | 顺利完成 |
| 09:30-09:55 | 需求文档编写 | ✅ | 90% | 需要补充细节 |
| 10:00-10:25 | 界面设计构思 | ⭕ | | 被电话打断 |
| **长休息 11:00-11:30** | **🍃 休息时间** |   |        |               |
| 11:30-11:55 | 核心功能开发 | ✅ | 80% | 遇到技术问题 |

### 今日总结

**完成的任务：**
- ✅ 完成项目需求分析文档
- ✅ 编写核心功能代码

**未完成的任务：**
- ❌ 设计用户界面原型

**今日收获：**
通过番茄工作法，我发现自己能够更专注地处理复杂任务。

**明日改进点：**
1. 提前准备设计素材
2. 设置免打扰模式`;

            try {
                const result = parseAndImportMarkdown(testData);
                document.getElementById('parseResult').textContent = 
                    '解析成功！\n\n' +
                    '任务数据：' + JSON.stringify(result.tasks, null, 2) + '\n\n' +
                    '番茄时段数据：' + JSON.stringify(result.pomodoroData, null, 2) + '\n\n' +
                    '完成的任务：' + JSON.stringify(result.completedTasks, null, 2) + '\n\n' +
                    '未完成的任务：' + JSON.stringify(result.incompleteTasks, null, 2) + '\n\n' +
                    '今日收获：' + result.dailyGains + '\n\n' +
                    '明日改进点：' + result.improvements;
            } catch (error) {
                document.getElementById('parseResult').textContent = '解析失败：' + error.message;
            }
        }
        
        function testFileImport() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.md,.txt';
            fileInput.style.display = 'none';
            
            fileInput.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const markdownContent = e.target.result;
                            const result = parseAndImportMarkdown(markdownContent);
                            document.getElementById('importResult').textContent = 
                                '文件导入成功！\n\n' +
                                '解析到的数据：\n' +
                                '任务数量：' + result.tasks.length + '\n' +
                                '番茄时段数量：' + result.pomodoroData.length + '\n' +
                                '完成的任务数量：' + result.completedTasks.length + '\n' +
                                '未完成的任务数量：' + result.incompleteTasks.length;
                        } catch (error) {
                            document.getElementById('importResult').textContent = '导入失败：' + error.message;
                        }
                    };
                    reader.readAsText(file, 'utf-8');
                }
            };
            
            document.body.appendChild(fileInput);
            fileInput.click();
            document.body.removeChild(fileInput);
        }
    </script>
</body>
</html> 