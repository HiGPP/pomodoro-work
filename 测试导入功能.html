<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯¼å…¥åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Markdownå¯¼å…¥åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h3>æµ‹è¯•æ•°æ®è§£æ</h3>
        <button onclick="testParseMarkdown()">æµ‹è¯•è§£æç¤ºä¾‹æ•°æ®</button>
        <div id="parseResult" class="result"></div>
    </div>
    
    <div class="test-section">
        <h3>æ–‡ä»¶å¯¼å…¥æµ‹è¯•</h3>
        <button onclick="testFileImport()">é€‰æ‹©æ–‡ä»¶æµ‹è¯•å¯¼å…¥</button>
        <div id="importResult" class="result"></div>
    </div>

    <script>
        // æ¨¡æ‹Ÿè§£æå‡½æ•°
        function parseAndImportMarkdown(markdownContent) {
            try {
                const lines = markdownContent.split('\n');
                let currentSection = '';
                let tasks = [];
                let pomodoroData = [];
                let completedTasks = [];
                let incompleteTasks = [];
                let dailyGains = '';
                let improvements = '';
                
                for (let i = 0; i < lines.length; i++) {
                    const line = lines[i].trim();
                    
                    // æ£€æµ‹ç« èŠ‚
                    if (line.startsWith('### ä»Šæ—¥ç›®æ ‡ä»»åŠ¡')) {
                        currentSection = 'tasks';
                        continue;
                    } else if (line.startsWith('### ç•ªèŒ„æ—¶æ®µè®°å½•')) {
                        currentSection = 'pomodoro';
                        continue;
                    } else if (line.startsWith('**å®Œæˆçš„ä»»åŠ¡ï¼š**')) {
                        currentSection = 'completed';
                        continue;
                    } else if (line.startsWith('**æœªå®Œæˆçš„ä»»åŠ¡ï¼š**')) {
                        currentSection = 'incomplete';
                        continue;
                    } else if (line.startsWith('**ä»Šæ—¥æ”¶è·ï¼š**')) {
                        currentSection = 'gains';
                        continue;
                    } else if (line.startsWith('**æ˜æ—¥æ”¹è¿›ç‚¹ï¼š**')) {
                        currentSection = 'improvements';
                        continue;
                    }
                    
                    // è§£æä»»åŠ¡
                    if (currentSection === 'tasks' && line.startsWith('- [')) {
                        const taskMatch = line.match(/- \[([ x])\] ä»»åŠ¡(\d+)ï¼š(.+)/);
                        if (taskMatch) {
                            const status = taskMatch[1];
                            const taskNum = taskMatch[2];
                            const taskText = taskMatch[3];
                            tasks.push({
                                number: parseInt(taskNum),
                                text: taskText,
                                completed: status === 'x'
                            });
                        }
                    }
                    
                    // è§£æç•ªèŒ„æ—¶æ®µ
                    if (currentSection === 'pomodoro' && line.startsWith('|') && !line.includes('---')) {
                        const parts = line.split('|').map(p => p.trim()).filter(p => p);
                        if (parts.length >= 5) {
                            const timeRange = parts[0];
                            const taskContent = parts[1];
                            const status = parts[2];
                            const completion = parts[3];
                            const notes = parts[4];
                            
                            pomodoroData.push({
                                timeRange: timeRange,
                                taskContent: taskContent,
                                status: status,
                                completion: completion,
                                notes: notes
                            });
                        }
                    }
                    
                    // è§£æå®Œæˆçš„ä»»åŠ¡
                    if (currentSection === 'completed' && line.startsWith('- âœ…')) {
                        const taskText = line.replace('- âœ…', '').trim();
                        if (taskText) {
                            completedTasks.push(taskText);
                        }
                    }
                    
                    // è§£ææœªå®Œæˆçš„ä»»åŠ¡
                    if (currentSection === 'incomplete' && line.startsWith('- âŒ')) {
                        const taskText = line.replace('- âŒ', '').trim();
                        if (taskText) {
                            incompleteTasks.push(taskText);
                        }
                    }
                    
                    // è§£æä»Šæ—¥æ”¶è·
                    if (currentSection === 'gains' && line && !line.startsWith('**')) {
                        if (dailyGains) dailyGains += '\n';
                        dailyGains += line;
                    }
                    
                    // è§£ææ˜æ—¥æ”¹è¿›ç‚¹
                    if (currentSection === 'improvements' && line && !line.startsWith('**')) {
                        if (improvements) improvements += '\n';
                        improvements += line;
                    }
                }
                
                return {
                    tasks: tasks,
                    pomodoroData: pomodoroData,
                    completedTasks: completedTasks,
                    incompleteTasks: incompleteTasks,
                    dailyGains: dailyGains,
                    improvements: improvements
                };
                
            } catch (error) {
                console.error('è§£æå¤±è´¥:', error);
                throw error;
            }
        }
        
        function testParseMarkdown() {
            const testData = `# ç•ªèŒ„å·¥ä½œæ³•è¿½è¸ªè¡¨

## æ—¥æœŸï¼š2024å¹´1æœˆ15æ—¥ æ˜ŸæœŸä¸€

### ä»Šæ—¥ç›®æ ‡ä»»åŠ¡
- [x] ä»»åŠ¡1ï¼šå®Œæˆé¡¹ç›®éœ€æ±‚åˆ†ææ–‡æ¡£
- [ ] ä»»åŠ¡2ï¼šè®¾è®¡ç”¨æˆ·ç•Œé¢åŸå‹
- [x] ä»»åŠ¡3ï¼šç¼–å†™æ ¸å¿ƒåŠŸèƒ½ä»£ç 

### ç•ªèŒ„æ—¶æ®µè®°å½•

| æ—¶é—´æ®µ | ä»»åŠ¡å†…å®¹ | å®ŒæˆçŠ¶æ€ | å®Œæˆåº¦ | å¤‡æ³¨/å¹²æ‰°è®°å½• |
|--------|----------|----------|--------|---------------|
| 09:00-09:25 | é¡¹ç›®éœ€æ±‚åˆ†æ | âœ… | 100% | é¡ºåˆ©å®Œæˆ |
| 09:30-09:55 | éœ€æ±‚æ–‡æ¡£ç¼–å†™ | âœ… | 90% | éœ€è¦è¡¥å……ç»†èŠ‚ |
| 10:00-10:25 | ç•Œé¢è®¾è®¡æ„æ€ | â­• | | è¢«ç”µè¯æ‰“æ–­ |
| **é•¿ä¼‘æ¯ 11:00-11:30** | **ğŸƒ ä¼‘æ¯æ—¶é—´** |   |        |               |
| 11:30-11:55 | æ ¸å¿ƒåŠŸèƒ½å¼€å‘ | âœ… | 80% | é‡åˆ°æŠ€æœ¯é—®é¢˜ |

### ä»Šæ—¥æ€»ç»“

**å®Œæˆçš„ä»»åŠ¡ï¼š**
- âœ… å®Œæˆé¡¹ç›®éœ€æ±‚åˆ†ææ–‡æ¡£
- âœ… ç¼–å†™æ ¸å¿ƒåŠŸèƒ½ä»£ç 

**æœªå®Œæˆçš„ä»»åŠ¡ï¼š**
- âŒ è®¾è®¡ç”¨æˆ·ç•Œé¢åŸå‹

**ä»Šæ—¥æ”¶è·ï¼š**
é€šè¿‡ç•ªèŒ„å·¥ä½œæ³•ï¼Œæˆ‘å‘ç°è‡ªå·±èƒ½å¤Ÿæ›´ä¸“æ³¨åœ°å¤„ç†å¤æ‚ä»»åŠ¡ã€‚

**æ˜æ—¥æ”¹è¿›ç‚¹ï¼š**
1. æå‰å‡†å¤‡è®¾è®¡ç´ æ
2. è®¾ç½®å…æ‰“æ‰°æ¨¡å¼`;

            try {
                const result = parseAndImportMarkdown(testData);
                document.getElementById('parseResult').textContent = 
                    'è§£ææˆåŠŸï¼\n\n' +
                    'ä»»åŠ¡æ•°æ®ï¼š' + JSON.stringify(result.tasks, null, 2) + '\n\n' +
                    'ç•ªèŒ„æ—¶æ®µæ•°æ®ï¼š' + JSON.stringify(result.pomodoroData, null, 2) + '\n\n' +
                    'å®Œæˆçš„ä»»åŠ¡ï¼š' + JSON.stringify(result.completedTasks, null, 2) + '\n\n' +
                    'æœªå®Œæˆçš„ä»»åŠ¡ï¼š' + JSON.stringify(result.incompleteTasks, null, 2) + '\n\n' +
                    'ä»Šæ—¥æ”¶è·ï¼š' + result.dailyGains + '\n\n' +
                    'æ˜æ—¥æ”¹è¿›ç‚¹ï¼š' + result.improvements;
            } catch (error) {
                document.getElementById('parseResult').textContent = 'è§£æå¤±è´¥ï¼š' + error.message;
            }
        }
        
        function testFileImport() {
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = '.md,.txt';
            fileInput.style.display = 'none';
            
            fileInput.onchange = function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const markdownContent = e.target.result;
                            const result = parseAndImportMarkdown(markdownContent);
                            document.getElementById('importResult').textContent = 
                                'æ–‡ä»¶å¯¼å…¥æˆåŠŸï¼\n\n' +
                                'è§£æåˆ°çš„æ•°æ®ï¼š\n' +
                                'ä»»åŠ¡æ•°é‡ï¼š' + result.tasks.length + '\n' +
                                'ç•ªèŒ„æ—¶æ®µæ•°é‡ï¼š' + result.pomodoroData.length + '\n' +
                                'å®Œæˆçš„ä»»åŠ¡æ•°é‡ï¼š' + result.completedTasks.length + '\n' +
                                'æœªå®Œæˆçš„ä»»åŠ¡æ•°é‡ï¼š' + result.incompleteTasks.length;
                        } catch (error) {
                            document.getElementById('importResult').textContent = 'å¯¼å…¥å¤±è´¥ï¼š' + error.message;
                        }
                    };
                    reader.readAsText(file, 'utf-8');
                }
            };
            
            document.body.appendChild(fileInput);
            fileInput.click();
            document.body.removeChild(fileInput);
        }
    </script>
</body>
</html> 