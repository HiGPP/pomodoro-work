# 🍅 番茄工作法追踪器 - 本地应用

## 📱 手机访问解决方案

### 🚀 快速启动

#### Windows用户
1. 双击 `启动番茄时钟.bat` 文件
2. 等待服务器启动
3. 在手机浏览器中输入显示的IP地址

#### Linux/Mac用户
1. 打开终端，进入项目目录
2. 运行：`chmod +x 启动番茄时钟.sh`
3. 运行：`./启动番茄时钟.sh`
4. 在手机浏览器中输入显示的IP地址

### 📋 文件说明

| 文件名 | 说明 |
|--------|------|
| `番茄工作表.html` | 主应用文件 |
| `app.py` | Python Web服务器 |
| `requirements.txt` | Python依赖包 |
| `启动番茄时钟.bat` | Windows启动脚本 |
| `启动番茄时钟.sh` | Linux/Mac启动脚本 |
| `M500001AfXaf3R6z8G.mp3` | 音频文件（可选） |

### 🔧 环境要求

#### 必需软件
- **Python 3.7+** 
  - Windows: https://www.python.org/downloads/
  - Linux: `sudo apt install python3 python3-pip`
  - macOS: `brew install python3`

#### 自动安装
启动脚本会自动安装所需的Python包：
- Flask (Web框架)
- Werkzeug (WSGI工具)

### 📱 手机访问步骤

#### 1. 启动服务器
```bash
# Windows
双击 启动番茄时钟.bat

# Linux/Mac
./启动番茄时钟.sh
```

#### 2. 查看访问地址
启动后会显示：
```
🍅 番茄工作法追踪器 - 本地服务器
================================================
📱 手机访问地址: http://192.168.1.100:5000
💻 电脑访问地址: http://localhost:5000
================================================
```

#### 3. 手机连接
1. 确保手机和电脑在同一个WiFi网络
2. 在手机浏览器中输入显示的IP地址
3. 开始使用番茄时钟！

### 📋 数据管理

#### Markdown导出功能
1. 点击"📋 复制为MD格式"按钮
2. 自动生成完整的Markdown内容
3. 复制到剪贴板，可粘贴到任何支持Markdown的应用

#### Markdown导入功能
1. 点击"📥 从MD导入"按钮
2. 选择之前导出的Markdown文件
3. 自动解析并导入数据到应用中

#### 支持导入的数据类型
- ✅ **日期信息**：自动恢复工作日期
- ✅ **开始时间**：自动设置番茄时钟开始时间
- ✅ **今日目标任务**（包括完成状态）
- ✅ **番茄时段计划表**（时间段、任务内容、完成状态、完成度、备注）
- ✅ **任务选择状态**：智能匹配预设任务或保持手动输入
- ✅ 完成/未完成任务列表
- ✅ 今日收获
- ✅ 明日改进点

#### 数据同步流程
```
方式1：设备A → 下载备份 → 复制到设备B → 上传恢复 → 数据同步完成
方式2：设备A → 复制MD格式 → 复制到设备B → 手动记录 → 数据同步完成
```

### 💾 数据持久化

#### 自动保存功能
- **实时保存**：所有输入和操作都会自动保存
- **防抖机制**：避免频繁保存，提高性能
- **页面关闭保存**：关闭页面时自动保存数据
- **24小时有效期**：数据保存24小时后自动清除

#### 保存的数据类型
- ✅ **基本信息**：日期、开始时间、任务数量
- ✅ **任务数据**：任务内容和完成状态
- ✅ **番茄时段**：时间段、任务、状态、完成度、备注
- ✅ **总结数据**：完成/未完成任务、收获、改进点
- ✅ **统计信息**：完成数量、平均完成度等

#### 数据管理
- **自动恢复**：刷新页面后自动恢复所有数据
- **手动清除**：点击"🗑️ 清除数据"按钮清除所有保存的数据
- **Markdown导出**：使用"📋 复制为MD格式"功能导出数据用于分享
- **数据备份**：使用"📥 下载备份文件"功能备份重要数据
- **数据恢复**：使用"📤 上传恢复文件"功能恢复备份数据
- **任务同步**：使用"🔄 同步任务"功能自动同步已完成和未完成任务

### 📊 数据导出功能对比

| 功能 | 格式 | 用途 | 特点 |
|------|------|------|------|
| **复制为MD格式** | Markdown | 分享、记录、文档 | 可读，便于分享和记录 |
| **下载备份文件** | JSON | 完整备份、恢复 | 完整数据，支持自动恢复 |
| **上传恢复文件** | JSON | 数据恢复 | 一键恢复所有数据 |
| **同步任务** | 自动同步 | 任务状态同步 | 根据时间表自动更新已完成/未完成任务 |

**使用建议：**
- **日常分享**：使用MD格式，便于在聊天工具中分享
- **重要备份**：使用JSON备份文件，确保数据完整性
- **跨设备同步**：优先使用JSON备份，MD格式作为补充
- **任务管理**：使用同步任务功能，自动更新任务状态

### 🔄 任务自动同步功能

#### 同步逻辑
- **已完成任务**：根据时间表中标记为"✅ 已完成"的任务自动记录
- **未完成任务**：今日目标任务中除去已完成任务后剩余的任务
- **自动触发**：当时间表中的任务状态发生变化时自动同步
- **手动同步**：点击"🔄 同步任务"按钮手动触发同步

#### 同步时机
- ✅ 时间表任务状态改变时
- ✅ 任务内容输入时
- ✅ 生成时间表时
- ✅ 统计数据更新时
- ✅ 数据恢复后
- ✅ 手动点击同步按钮时

#### 同步结果
- 📊 显示同步统计信息
- ✅ 自动更新已完成任务列表
- ❌ 自动更新未完成任务列表
- 💾 同步后自动保存数据

### 🎵 音频设置

#### 本地音频文件
1. 将音频文件放在项目目录下
2. 修改 `番茄工作表.html` 中的音频路径：
   ```javascript
   const audioPath = './your-audio-file.mp3';
   ```

#### 在线音频模式
- 使用公开的在线音频文件
- 支持所有设备访问

#### 备用音频模式
- 使用浏览器内置音频生成
- 兼容性最好

#### 静音模式
- 完全不播放音频
- 适合安静环境

### 🔒 安全说明

#### 网络访问
- 服务器绑定到 `0.0.0.0`，允许局域网访问
- 仅在同一WiFi网络内的设备可以访问
- 不会暴露到公网

#### 防火墙设置
如果无法访问，请检查：
1. Windows防火墙是否允许Python
2. 路由器是否阻止了端口5000
3. 杀毒软件是否拦截了连接

### 🛠️ 故障排除

#### 常见问题

**Q: 手机无法访问**
A: 检查：
- 手机和电脑是否在同一WiFi
- 防火墙是否阻止了连接
- IP地址是否正确

**Q: 音频无法播放**
A: 尝试：
- 切换到"备用音频"模式
- 检查音频文件路径
- 使用"静音模式"

**Q: 启动失败**
A: 检查：
- Python是否正确安装
- 网络连接是否正常
- 文件是否完整

#### 手动启动
如果自动启动失败，可以手动运行：
```bash
# 安装依赖
pip install flask

# 启动服务器
python app.py
```

### 📞 技术支持

如果遇到问题：
1. 检查控制台输出的错误信息
2. 确认所有文件都在同一目录
3. 尝试重启服务器

### 🎯 功能特点

#### ✅ 多设备支持
- 电脑：完整功能
- 手机：响应式设计
- 平板：完美适配

#### ✅ 音频选项
- 在线音频：音质好
- 备用音频：兼容性强
- 静音模式：适合安静环境

#### ✅ 智能通知
- 全屏通知
- 桌面通知
- 震动提醒

#### ✅ 数据管理
- **自动保存**：数据自动保存到浏览器本地存储
- **刷新恢复**：刷新页面后数据自动恢复
- **设置记忆**：所有设置和输入都会自动保存
- **任务记录**：任务列表和完成状态持久化
- **Markdown导出**：复制为MD格式，便于分享和记录
- **JSON备份/恢复**：支持数据备份和恢复
- **多设备数据同步**：通过备份文件或MD格式同步数据

---

**享受您的番茄工作时光！** 🍅✨ 
